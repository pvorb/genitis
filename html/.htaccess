#### For detail information on mod_rewrite see http://httpd.apache.org/docs/3.2/mod/mod_rewrite.html ####

RewriteEngine		On
RewriteBase			/

RewriteCond			%{HTTP_HOST}	^ip\.genitis\.org				[OR]
RewriteCond			%{HTTP_HOST}	^ip\.localhost
RewriteRule			^(.*)$			manager.php?dir&url=project/ip/$1		[L,QSA,NC]

RewriteCond			%{HTTP_HOST}	^yuki\.genitis\.org				[OR]
RewriteCond			%{HTTP_HOST}	^yuki\.localhost
RewriteRule			^(.*)$			manager.php?dir&url=project/yuki/$1		[L,QSA,NC]

RewriteCond			%{HTTP_HOST}	^genitis\.org$					[NC,OR]
RewriteCond			%{HTTP_HOST}	^(www\.)?paulvorbach\.de$		[NC]
RewriteRule			^(.*)$			http://www.genitis.org/$1		[L,R=301]

##################################
# Handle Directories
##################################

# Map /dir -> /dir/ if /dir/ is a directory.
RewriteCond			%{REQUEST_FILENAME}/	-d
RewriteCond			%{REQUEST_URI}			!(.*)/$
RewriteRule			^(.*)$					/$1/					[L,R=301]

# Internally map to /index.php?dir=*
RewriteCond			%{REQUEST_FILENAME}		-d
RewriteCond			%{REQUEST_URI}			(.*)/$
RewriteRule			^(.*)$					/manager.php?dir&url=$1		[L,QSA,NC]

##################################
# Handle HTML files
##################################

# Map file.html -> file
RewriteRule			^(.*)\.html$			/$1						[L,R=301]

# Map path/index -> path/ //Remove index, because it is unnessecary.
RewriteRule			^((.*/)*)index$			/$1						[L,R=301]

# Map file/ -> file
RewriteCond			%{REQUEST_FILENAME}		!-d
RewriteRule			^(.*)/$					/$1						[L,R=301]

# Internally map to /index.php?file=*
RewriteCond			%{REQUEST_FILENAME}.html	-f
RewriteCond			%{REQUEST_URI}			!(.*)/$
RewriteRule			^(.*)$					/manager.php?file&url=$1		[L,QSA,NC]

# Internally map bad requests to /index.php?err=*
RewriteCond			%{REQUEST_FILENAME}		!-d
RewriteCond			%{REQUEST_FILENAME}/	!-d
RewriteCond			%{REQUEST_FILENAME}		!-f
RewriteCond			%{REQUEST_FILENAME}.html	!-f
RewriteRule			^(.*)$					/index.php?err&url=$1		[L,QSA,NC]
